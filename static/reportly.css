:root{
  --bg: #0e0e10;          /* page background (near-black) */
  --card: #141416;        /* panel background */
  --muted: #9a9aa0;       /* secondary text */
  --text: #e6e6e9;        /* primary text */
  --border: #2a2a2e;      /* subtle borders */
  --accent: #bcbcc2;      /* neutral accent for buttons/links */
  --accent-strong: #d6d6da;
  --shadow: 0 8px 24px rgba(0,0,0,.35);
}

html, body {
  background: var(--bg);
  color: var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  margin: 0;
}

/* Header */
.reportly-header{
  display:flex; align-items:center; justify-content:space-between;
  gap:1rem; padding:1rem 1.25rem; margin-bottom:1rem;
  border-bottom: 1px solid var(--border);
}
.reportly-title{ display:flex; align-items:center; gap:.75rem; }
.reportly-logo{ width:28px; height:28px; object-fit:contain; filter:grayscale(1); }
.reportly-title h1{ margin:0; font-size:1.15rem; letter-spacing:.3px; }
.doc-pill{
  padding:.2rem .5rem; border:1px solid var(--border); border-radius:999px;
  font-size:.8rem; color:var(--muted); background:#0f0f11;
}
.reportly-actions .inline{ display:inline; }

/* Flash */
.flash-wrap{ max-width:1400px; margin:0 auto 1rem; padding:0 1rem; }
.flash{
  border:1px solid var(--border); border-left:4px solid var(--accent);
  background:#0f0f11; padding:.75rem 1rem; border-radius:.5rem; box-shadow: var(--shadow);
}
.flash-error{ border-left-color:#8a8a8f; }   /* neutral severity */
.flash-success{ border-left-color:#c2c2c8; } /* neutral success */

/* Layout: chat-focused */
.row.chat-layout{
  max-width: 95%; margin:0 auto; padding:0 1rem 2rem;
  display:grid; gap:1.25rem; grid-template-columns: 1.1fr 1fr;
}
@media (max-width: 1100px){
  .row.chat-layout{ grid-template-columns: 1fr; }
}

.col{ min-width:0; }
.col.left .card { margin-top: 8px; }
.col.right .card { margin-top: 8px; }

/* Cards */
.card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 1rem 1.25rem;
  box-shadow: var(--shadow);
}

/* Buttons (neutral gradient + greyscale states) */
.btn{
  appearance:none; border:none; cursor:pointer; user-select:none;
  background: linear-gradient(180deg, var(--accent-strong), var(--accent));
  color:#1a1a1c; font-weight:800; letter-spacing:.2px;
  padding:.55rem .9rem; border-radius:.6rem;
  transition: transform .08s ease, box-shadow .15s ease, filter .15s ease, background .15s ease;
  box-shadow: 0 6px 18px rgba(0,0,0,.25);
}
.btn:hover{ transform: translateY(-1px); filter: brightness(0.95); }
.btn:active{ transform: translateY(0); filter: brightness(0.9); }
.btn-ghost{ background: transparent; color: var(--text); border:1px solid var(--border); box-shadow:none; }
.btn-accent{ background: linear-gradient(180deg, var(--accent-strong), var(--accent)); color:#1a1a1c; }

/* Chat */
.chat-card h2{ margin-top: 0; }
.chat-log{
  background:#0f0f11; border:1px solid var(--border); border-radius:12px;
  padding: .75rem; max-height: 40vh; overflow:auto; margin-bottom:.75rem;
}
.chat-msg{ display:flex; margin-bottom:.45rem; }
.chat-msg .bubble{
  padding:.55rem .75rem; border-radius:.7rem; max-width: 90%;
}
.chat-msg.user{ justify-content:flex-end; }
.chat-msg.user .bubble{
  background: #1a1a1e;
  color: var(--text);
  border:1px solid #2f2f34;
  border-top-right-radius:.25rem;
}
.chat-msg.assistant{ justify-content:flex-start; }
.chat-msg.assistant .bubble{
  background: #101012;
  color: var(--text);
  border:1px solid var(--border);
  border-top-left-radius:.25rem;
}
.chat-form textarea{
  width:100%; border:1px solid var(--border); border-radius:.6rem; background:#101012; color:var(--text);
  padding:.65rem .8rem; resize:vertical; min-height:90px; outline:none;
}
.chat-form textarea:focus{ border-color: #4b4b52; box-shadow: 0 0 0 3px rgba(200,200,205,.18); }
.chat-controls{
  display:flex; align-items:center; gap:.6rem; justify-content:flex-end; margin-top:.5rem; flex-wrap:wrap;
}
.chat-controls select, .chat-controls input[type=number]{
  background:#101012; color: var(--text); border:1px solid var(--border); border-radius:.4rem; padding:.35rem .5rem;
}

/* Toggles & Upload */
.divider{ height:1px; background:var(--border); margin: .9rem 0; }
.checkbox{ display:flex; align-items:center; gap:.5rem; color:var(--muted); }

.upload-form{ display:flex; gap:.65rem; align-items:center; flex-wrap:wrap; }
.file{
  position:relative; display:inline-flex; align-items:center; gap:.6rem;
  padding:.5rem .7rem; border:1px dashed var(--border); border-radius:.6rem; background:#0f0f11;
}
.file input[type=file]{ position:absolute; inset:0; opacity:0; cursor:pointer; }
.file-cta{ font-weight:600; color:var(--text); }
.muted{ color: var(--muted); }

/* Preview panel */
.sticky{ position: sticky; top: 12px; }
.editor-head{ display:flex; align-items:center; justify-content:space-between; }

/* Utilities */
.sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

/* Slim hero override */
.page-hero,
.page-hero.page-hero--slim {
  height: auto !important;
  min-height: 0 !important;
  padding: 12px 0 8px !important;
  scroll-margin-top: var(--nav-h,72px);
}

/* Use a narrow hero container so it doesn't span 1200px */
.page-hero .hero-container {
  max-width: 760px;
  margin: 0 auto;
  padding: 0 12px;
}

/* Tighter typography */
.page-hero .hero-title {
  margin: 0 0 4px;
  font-size: clamp(22px, 3.2vw, 34px);
  line-height: 1.2;
}

.page-hero .hero-sub {
  margin: 0;
  color: var(--muted);
  font-size: clamp(13px, 1.6vw, 16px);
  line-height: 1.45;
  max-width: 56ch;
  text-align: center;
  margin-inline: auto;
}

.dl-mac{
  display:inline-flex;align-items:center;gap:.6rem;
  padding:.85rem 1.1rem;border:1px solid var(--border);border-radius:12px;
  text-decoration:none;font-weight:600;color:var(--text);background:#121214;
  box-shadow:0 8px 24px rgba(0,0,0,.25)
}
.dl-mac:hover{box-shadow:0 14px 34px rgba(0,0,0,.3)}
.dl-mac svg{width:20px;height:20px;fill:currentColor;filter:grayscale(1)}

/* --- Print Tool (dot_print / print.py UI) ------------------------------ */
.box{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 1rem 1.25rem;
  box-shadow: var(--shadow);
  max-width: 1200px;
  margin: 1rem auto;
}

.box .row{
  display:flex; align-items:center; gap:.65rem; flex-wrap:wrap;
  margin: .5rem 0;
}

.box h3{ margin:0; font-size:1.05rem; letter-spacing:.2px; }
#print-status{ color: var(--muted); font-size:.9rem; }

/* Inputs in toolbar */
#print-depth{
  background:#101012; color:var(--text);
  border:1px solid var(--border); border-radius:.45rem;
  padding:.35rem .55rem; width:88px;
}

/* Button variant used in this tool */
.btn.secondary{
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
  box-shadow: none;
}
.btn.secondary:hover{
  border-color: #4b4b52;
  box-shadow: 0 6px 20px rgba(0,0,0,.18);
}

/* Details panels */
.box details{
  border: 1px solid var(--border);
  border-radius: 12px;
  background: #0f0f11;
  margin-top: .75rem;
  overflow: hidden;
}
.box details + details{ margin-top: .6rem; }

.box summary{
  cursor: pointer;
  list-style: none;
  padding: .75rem .9rem;
  font-weight: 700;
  color: var(--text);
  position: relative;
  outline: none;
  user-select: none;
}
.box summary::-webkit-details-marker{ display:none; }

/* Chevron */
.box summary::after{
  content: "";
  position: absolute;
  right: .9rem; top: 50%;
  width: .6rem; height: .6rem;
  border-right: 2px solid var(--muted);
  border-bottom: 2px solid var(--muted);
  transform: translateY(-60%) rotate(45deg);
  transition: transform .18s ease, border-color .18s ease;
}
.box details[open] summary::after{
  transform: translateY(-30%) rotate(-135deg);
  border-color: var(--accent);
}

/* Panel body */
.box details > *:not(summary){
  padding: .75rem .9rem .9rem;
  border-top: 1px solid var(--border);
}

/* Textareas (tree + contents) */
#print-tree,
#print-contents{
  width: 100%;
  min-height: clamp(200px, 38vh, 520px);
  background: #101012;
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: .75rem .85rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 13.5px;
  line-height: 1.45;
  resize: vertical;
  white-space: pre-wrap;
  overflow: auto;
}

/* Buttons under textareas */
.box .row button.btn.secondary{
  padding: .5rem .7rem;
}

/* Hide Grammarly / lt mirror artifacts */
lt-mirror, .lt-mirror, .lt-mirror__wrapper{ display:none !important; }

/* Scrollbar cosmetics (WebKit) */
#print-tree::-webkit-scrollbar,
#print-contents::-webkit-scrollbar{
  height: 10px; width: 10px;
}
#print-tree::-webkit-scrollbar-thumb,
#print-contents::-webkit-scrollbar-thumb{
  background: #3a3a3f; border-radius: 8px;
  border: 2px solid #101012;
}
#print-tree::-webkit-scrollbar-track,
#print-contents::-webkit-scrollbar-track{
  background: #101012;
}

/* Responsive tweaks */
@media (max-width: 800px){
  .box{ padding: .9rem; }
  #print-tree, #print-contents{ min-height: clamp(180px, 32vh, 440px); }
  .box .row{ gap:.5rem; }
}

/* Small link hint at bottom */
.box p.muted a{
  color: var(--accent);
  text-decoration: none;
  border-bottom: 1px dotted rgba(200,200,205,.4);
}
.box p.muted a:hover{
  border-bottom-color: var(--accent);
}

/* Layout helper */
.row.between { justify-content: space-between; }

/* Title color */
.box-title{
  margin: 0;
  font-size: 1.05rem;
  letter-spacing: .2px;
  color: var(--text);
}

/* Fix invalid var() and keep theme */
.row h3 { color: var(--text); }

/* .print modal (light theme inside modal) */
#print-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:9999}
#print-modal .box{max-width:980px;margin:5vh auto;background:#fff;border-radius:14px;padding:16px;box-shadow:0 20px 90px rgba(0,0,0,.35)}
#print-modal .row{display:flex;gap:12px;align-items:center;margin:8px 0 12px}
#print-modal .row.between{justify-content:space-between}
#print-modal textarea{width:100%;height:220px;border:1px solid #e4e4e7;border-radius:8px;padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
#print-modal details{margin-top:10px}
#print-modal summary{cursor:pointer}
.btn.secondary{background:transparent;border:1px solid var(--border);color:var(--text)}
.btn.inline{margin-left:8px}
.muted{color:var(--muted)}

/* PDF viewer */
.viewer-bar{display:flex;align-items:center;gap:8px;justify-content:space-between;margin-bottom:8px}
.viewer-controls{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.preview-wrap{position:relative}
.preview-frame{width:100%;height:760px;border:1px solid var(--border);border-radius:12px;background:#fff}
.loading-veil{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(255,255,255,.6)}
.loading-veil.on{display:flex}

/* ChatGPT-like composer */
.composer{
  position:relative;
  background:#0c0f14;
  border:1px solid var(--border);
  border-radius: 14px;
  padding: 10px 44px 10px 40px; /* room for icons */
}

.composer textarea{
  width:100%;
  max-height:220px;
  min-height:44px;
  resize:none;
  border:0;
  outline:0;
  background:transparent;
  color:var(--text);
  font: 14px/1.45 inherit;
  overflow:auto;
}

/* icon buttons (inside composer) */
.icon-btn{
  position:absolute;
  width:28px; height:28px;
  display:inline-flex; align-items:center; justify-content:center;
  border:0; border-radius:6px;
  background:transparent; color:var(--muted);
  cursor:pointer;
}
.icon-btn:hover{ color:#fff; background:#121821; }
.icon-btn:active{ transform:translateY(1px); }

.composer-plus{ left:8px; bottom:8px; }
.composer-actions{ position:absolute; right:6px; bottom:6px; display:flex; gap:6px; }
.send-btn{ background:#1b1f22; color:#fff; padding:0; }
.send-btn:hover{ background:#20262b; }

/* Plus menu anchored above the composer */
.plus-menu{
  position:absolute;
  left:0; top:calc(100% + 8px);
  width:320px; max-width:min(90vw, 360px);
  background:#0c0f14;
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow: var(--shadow);
  padding:.75rem;
  z-index:30;
}
.plus-menu-section{ margin-bottom:.75rem; }
.plus-menu-section:last-child{ margin-bottom:0; }
.plus-menu-section h3{ margin:.25rem 0 .5rem; font-size:.85rem; color:var(--muted); }

.plus-menu .btn.secondary{ width:100%; text-align:left; margin-bottom:.3rem; }
.plus-menu select, .plus-menu input[type=number]{
  width:100%; background:#0a0d12; color:var(--text);
  border:1px solid var(--border); border-radius:8px; padding:.45rem .6rem;
  margin:.35rem 0 .5rem;
}

/* Make sure the chat area reserves space for the menu when open */
.chat-input-wrap{ position:relative; }

/* === Composer fixes: make paperclip visible + send clickable === */
.composer{ position: relative; }

/* Keep the textarea under the controls */
.composer textarea{ position: relative; z-index: 0; }

/* Action cluster sits above textarea, right-bottom corner */
.composer .composer-actions{
  position: absolute;
  right: 6px;
  bottom: 6px;
  display: flex;
  gap: 6px;
  z-index: 2;               /* <- above textarea */
}

/* Icons inside the actions should be in normal flow, not absolute */
.composer .icon-btn{
  position: static;         /* <- key change */
  width: 28px; height: 28px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border: 0; border-radius: 6px;
  background: transparent;
  color: var(--muted);
  line-height: 0;
  cursor: pointer;
}
.composer .icon-btn svg{
  width: 18px; height: 18px;
  display: block;
}
.composer .icon-btn:hover{ color: #fff; background: #121821; }
.composer .icon-btn:active{ transform: translateY(1px); }

/* Send button style (still submits the form) */
.composer .send-btn{
  background: #1b1f22;
  color: #fff;
  border-radius: 6px;
}
.composer .send-btn:hover{ background: #20262b; }

/* Only the plus button is absolutely positioned on the left */
.composer .composer-plus{
  position: absolute !important;
  left: 8px;
  bottom: 8px;
  z-index: 2;
}

/* Ensure the plus menu anchors to the input wrapper area */
.chat-input-wrap{ position: relative; }
.plus-menu{
  position: absolute;
  left: 0;
  top: calc(100% + 8px);  /* below the composer; switch to bottom:calc(100%+8px) to show above */
  z-index: 30;
}

/* === Composer: grid layout (no overlap) === */
.composer{
  display: grid;
  grid-template-columns: 32px 1fr auto;
  align-items: end;                 /* bottoms align cleanly */
  gap: 8px;
  padding: 10px;                    /* no icon-reserve padding */
  border-radius: 14px;
}

/* Textarea lives in the middle column and can grow */
.composer textarea{
  grid-column: 2;
  grid-row: 1;
  min-height: 44px;
  max-height: 220px;
  resize: none;
  overflow: auto;
  margin: 0;
  min-width: 0;                     /* prevent overflow in grid */
  position: static;                 /* ensure it doesn't stack above icons */
  z-index: 0;
}

/* Plus button on the left (no absolute) */
.composer .composer-plus{
  grid-column: 1;
  grid-row: 1;
  justify-self: start;
  align-self: end;
  position: static !important;      /* override any earlier absolute */
}

/* Actions on the right: paperclip + send */
.composer .composer-actions{
  grid-column: 3;
  grid-row: 1;
  display: flex;
  gap: 6px;
  align-self: end;
  position: static !important;      /* override any earlier absolute */
  z-index: 1;
}

/* Icon buttons in-flow */
.composer .icon-btn{
  position: static;
  width: 28px; height: 28px;
  display: inline-flex; align-items: center; justify-content: center;
  border: 0; border-radius: 6px;
  background: transparent; color: var(--muted);
  line-height: 0;
  cursor: pointer;
}
.composer .icon-btn svg{ width:18px; height:18px; display:block; }
.composer .icon-btn:hover{ color:#fff; background:#121821; }
.composer .icon-btn:active{ transform: translateY(1px); }

/* Send button look */
.composer .send-btn{
  background:#1b1f22; color:#fff; border-radius:6px; padding:0 0; border:0;
}
.composer .send-btn:hover{ background:#20262b; }

/* Keep the plus-menu anchored under the composer (unchanged) */
.chat-input-wrap{ position: relative; }
.plus-menu{
  position: absolute;
  left: 0;
  top: calc(100% + 8px);
  z-index: 30;
}

/* Optional: tighter layout on small screens */
@media (max-width: 520px){
  .composer{ grid-template-columns: 28px 1fr 56px; }
}

/* === Split view: left | gutter | right ================================ */
:root{
  --split: 58%;         /* starting left width as percent */
  --gutter-w: 10px;     /* draggable gutter width */
}

.row.chat-layout{
  display: grid;
  grid-template-columns:
    minmax(320px, var(--split))  /* left pane width */
    var(--gutter-w)              /* gutter */
    minmax(360px, 1fr);          /* right pane takes the rest */
  gap: 0;                        /* gutter handles spacing */
}

/* Ensure grid children don't overflow */
.row.chat-layout > .col { min-width: 0; }

/* Gutter styles */
.row.chat-layout > .gutter{
  cursor: col-resize;
  background: linear-gradient(
    to right,
    transparent 0,
    rgba(255,255,255,.06) 48%,
    rgba(255,255,255,.12) 50%,
    rgba(255,255,255,.06) 52%,
    transparent 100%
  );
  border-left: 1px solid var(--border);
  border-right: 1px solid var(--border);
  transition: background .15s ease, box-shadow .15s ease;
}
.row.chat-layout > .gutter:hover,
.row.chat-layout > .gutter.is-dragging{
  background: rgba(255,255,255,.08);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
}

/* Mobile: collapse to single column, hide gutter */
@media (max-width: 1100px){
  .row.chat-layout{
    grid-template-columns: 1fr;
  }
  .row.chat-layout > .gutter{ display:none; }
}

#doc-logs .log-body { max-height: 260px; overflow: auto; font-size: 13px; line-height: 1.35; }
#doc-logs .log-line { padding: 4px 0; border-bottom: 1px dashed #eee; }
#doc-logs .lvl { display:inline-block; min-width: 28px; text-align:center; border:1px solid #ddd; border-radius: 6px; padding: 0 6px; margin-right:6px; }
#doc-logs .meta { color:#666; font-size: 12px; margin-left: 6px; }

