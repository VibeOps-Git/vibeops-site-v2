{% extends "base.html" %}

{% block head %}
  {{ super() }}
  {% if og %}
  <meta property="og:type" content="article">
  <meta property="og:title" content="{{ og.title }}">
  <meta property="og:description" content="{{ og.description }}">
  <meta property="og:url" content="{{ og.url }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ og.title }}">
  <meta name="twitter:description" content="{{ og.description }}">
  {% endif %}

  {# Cache-bust to ensure the latest CSS loads #}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/blog.css') }}?v=5">

  <!-- Flag this page as blog for scoped fixes -->
  <script>
    document.documentElement.classList.add('is-vblog');
    document.addEventListener('DOMContentLoaded', () => document.body.classList.add('is-vblog'));
  </script>

  <style>
    /* ================= BLOG PAGES ONLY ================= */

    /* 1) Header layer (non-sticky) */
    .is-vblog .site-header,
    .is-vblog .main-header,
    .is-vblog header[role="banner"],
    .is-vblog #site-header,
    .is-vblog .navbar {
      position: relative !important;
      top: auto !important;
      z-index: 2147483000 !important;
      box-shadow: none !important;
      backdrop-filter: none !important;
    }

    /* 2) Dropdown/menu at the absolute top */
    .is-vblog .nav-dropdown,
    .is-vblog .menu-panel,
    .is-vblog .menu,
    .is-vblog .dropdown,
    .is-vblog .dropdown-menu,
    .is-vblog .nav-menu[aria-expanded="true"],
    .is-vblog .menu-drawer,
    .is-vblog [data-nav-panel] {
      position: fixed !important;
      z-index: 2147483647 !important;
      inset: 0 auto auto 0; /* your own CSS can override placement */
    }

    /* 3) Strip stacking contexts from content */
    .is-vblog main,
    .is-vblog #main,
    .is-vblog .main,
    .is-vblog .content,
    .is-vblog #content,
    .is-vblog .page,
    .is-vblog #page,
    .is-vblog .vblog-root,
    .is-vblog .vblog-container,
    .is-vblog .vblog-article,
    .is-vblog .vblog-header,
    .is-vblog .vblog-title {
      position: static !important;
      z-index: 0 !important;
      transform: none !important;
      filter: none !important;
      will-change: auto !important;
      isolation: auto !important;
      perspective: none !important;
      contain: none !important;
    }
  </style>
{% endblock %}

{% block content %}
<div class="vblog-root">
  <div class="vblog-container">

    <nav class="vblog-breadcrumb">
      <a href="{{ url_for('blog_index') }}">‚Üê All posts</a>
    </nav>

    <article class="vblog-article">
      <header class="vblog-header">
        <p class="vblog-kicker">VibeOps Blog</p>
        <h1 class="vblog-title" id="vblog-post-title">{{ post.title }}</h1>
        <div class="vblog-meta">
          <span id="vblog-reading-time" aria-label="Estimated reading time"></span>
        </div>
      </header>

      <div class="vblog-post-body" id="vblog-post-body">
        {{ raw_html | safe }}
      </div>
    </article>

    <div class="vblog-cta">
      Enjoyed this? <a href="{{ url_for('booking') }}">Book a chat</a> to see how we can build this for your team.
    </div>

  </div>
</div>

<script>
  // reading time
  (function(){
    const body = document.getElementById('vblog-post-body');
    const meter = document.getElementById('vblog-reading-time');
    if(!body || !meter) return;
    const text = body.innerText || body.textContent || '';
    const words = text.trim().split(/\s+/).filter(Boolean).length;
    const mins = Math.max(1, Math.round(words / 200));
    meter.textContent = `${mins} min read`;
  })();

  // safety: remove any late CSS/JS inside injected fragment
  (function(){
    const scope = document.querySelector('.vblog-post-body');
    if(!scope) return;
    scope.querySelectorAll('script, link[rel="stylesheet"], style').forEach(n => n.remove());
  })();
</script>
{% endblock %}
