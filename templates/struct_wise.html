{% extends "base.html" %}

{% block title %}Beam Selection Assistant{% endblock %}

{% block extra_head %}
    <!-- MathJax for rendering equations -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
{% endblock %}

{% block content %}
<section class="struct-wise-page">
    <h2 data-aos="fade-up" data-aos-delay="100" class="glitch" data-text="Beam Selection">Beam Selection Assistant</h2>
    <p data-aos="fade-up" data-aos-delay="200" class="text-center">
        Paste your structural problem text below and hit "Process" (AI backend required).
        <br><strong>Note:</strong> The outputs below are example placeholders only. The actual AI backend for parsing, calculations, and beam selection is not integrated yet.
    </p>

    <!-- INPUT -->
    <section class="input-section" data-aos="fade-up" data-aos-delay="300">
      <label for="problemInput">1. Full Problem Text:</label>
      <textarea id="problemInput" rows="8"
        placeholder="e.g. Background: 7.5×7.5 grid… Loads: Dead 4.2 kPa… Question 1a: Factored moment for B1…"></textarea>
      <button id="processBtn" class="processBtn">Process</button>
    </section>

    <!-- PARSED PROBLEM -->
    <section class="output-section" data-aos="fade-up" data-aos-delay="400">
      <h2>2. Parsed Sections (Example Output)</h2>
      <div id="parsedOutput" class="box">
          <div class="parsed-section-item">
              <strong>Background:</strong> 7.5 x 7.5 grid, steel deck to purlins (B1), girders (B2), columns (C2).
          </div>
          <div class="parsed-section-item">
              <strong>Loads:</strong> Typical Floors - Dead 4.2 kPa, Live 3.6 kPa; Roof - Snow 1.8 kPa, Live 1.0 kPa, Dead 3.0 kPa.
          </div>
          <div class="parsed-section-item">
              <strong>Question 1a:</strong> Factored moment/shear for purlins (B1), max depth 400 mm.
          </div>
      </div>
    </section>

    <!-- CALCULATIONS -->
    <section class="output-section" data-aos="fade-up" data-aos-delay="500">
      <h2>3. Calculations (Example Output)</h2>
      <div id="calcOutput" class="box">
          <p>1. \( L_{\text{trib}} = \frac{7.5}{3} = 2.5 \, \text{m} \)</p>
          <p>2. \( w_f = 1.25 \times 4.2 + 1.5 \times 3.6 = 10.7 \, \text{kPa} \)</p>
          <p>3. \( V_f = \frac{7.5}{2} \times 2.5 \times 10.7 = 100 \, \text{kN} \)</p>
          <p>4. \( M_f = \frac{10.7 \times 2.5 \times 7.5^2}{8} = 188 \, \text{kN} \cdot \text{m} \)</p>
      </div>
    </section>

    <!-- BEAM SELECTION -->
    <section class="output-section" data-aos="fade-up" data-aos-delay="600">
      <h2>4. Beam Candidates (Example Output)</h2>
      <div id="beamOutput" class="box">
          <table border="1" cellpadding="6" cellspacing="0" style="width:100%;border-collapse:collapse">
              <thead style="background:#00ffcc;color:#0e0e0e">
                <tr>
                  <th>Section</th><th>Depth</th><th>Wt</th><th>Capacity</th>
                </tr>
              </thead>
              <tbody>
                <tr style="font-weight:bold; background-color: #005040 !important; color: #fff;">
                  <td>W310×45</td><td>310 mm</td><td>45 kg/m</td><td>200 kN·m</td>
                </tr>
                <tr>
                  <td>W360×39</td><td>360 mm</td><td>39 kg/m</td><td>180 kN·m</td>
                </tr>
                <tr>
                  <td>W410×60</td><td>406 mm</td><td>60 kg/m</td><td>250 kN·m</td>
                </tr>
              </tbody>
          </table>
          <p style="margin-top: 1rem; color: #00ffcc; font-weight: bold;">
              Recommended: W310×45 (lightest section ≥ 188 kN·m capacity & depth ≤ 400 mm)
          </p>
      </div>
    </section>
</section>
{% endblock %}

{% block extra_scripts %}
    <script>
        // Ensure MathJax typesets the initial placeholder content when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (window.MathJax) {
                // Typeset all elements with LaTeX content
                MathJax.typesetPromise().catch((err) => console.error('MathJax initial typesetting failed:', err));
            }
        });

        // Placeholder for processing button (requires backend integration)
        document.getElementById('processBtn').addEventListener('click', function() {
            // This alert is a temporary placeholder.
            // The actual fetch call logic is in static/js/struct_wise.js
            // The backend team should remove this alert and integrate the fetch logic.
            alert('AI backend not integrated yet. The outputs shown are example placeholders.');
        });
    </script>
    <script src="/static/js/struct_wise.js"></script>
{% endblock %}
